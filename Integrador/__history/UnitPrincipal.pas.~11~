unit UnitPrincipal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Phys, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.VCLUI.Wait,
  FireDAC.Comp.Client, Data.DB, FireDAC.Phys.MySQL, FireDAC.Phys.MySQLDef,
  IdAuthentication, IdBaseComponent, IdComponent, IdTCPConnection, IdTCPClient,
  IdHTTP, Vcl.StdCtrls, Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls, Datasnap.DBClient, System.JSON,
  Vcl.Buttons, Vcl.ComCtrls, Vcl.CustomizeDlg, System.ImageList, Vcl.ImgList,
  System.Win.TaskbarCore, Vcl.Taskbar, Vcl.DBCtrls, Vcl.Mask, UnitDmPrincipal;

type
  TfrmPrincipal = class(TForm)
    IdHTTP1: TIdHTTP;
    Panel1: TPanel;
    Label1: TLabel;
    Paginas: TPageControl;
    Review: TTabSheet;
    Panel2: TPanel;
    dbProduto: TDBGrid;
    Panel3: TPanel;
    dbCores: TDBGrid;
    Cadastro: TTabSheet;
    Panel4: TPanel;
    OpenDialog: TOpenDialog;
    Panel5: TPanel;
    Label5: TLabel;
    Label6: TLabel;
    RadioGroup2: TRadioGroup;
    btnImagemCor: TSpeedButton;
    Label7: TLabel;
    RadioGroup1: TRadioGroup;
    Label2: TLabel;
    Label3: TLabel;
    Label9: TLabel;
    Label4: TLabel;
    Navegador: TDBNavigator;
    btnImagemProduto: TSpeedButton;
    btnSalvar: TSpeedButton;
    btnDeletar: TSpeedButton;
    edtDescricaoProduto: TDBEdit;
    edtImagemProduto: TDBEdit;
    edtPrecoUnit: TDBEdit;
    edtDescricaoCor: TDBEdit;
    edtImagemCor: TDBEdit;
    procedure FormCreate(Sender: TObject);
    procedure btnImagemProdutoClick(Sender: TObject);
    procedure btnSalvarClick(Sender: TObject);
    procedure btnImagemCorClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmPrincipal: TfrmPrincipal;
  IdHTTP: TIdHTTP;
  Response: string;
  JSONObj: TJSONObject;
  CoresArray: TJSONArray;
  Cor: TJSONValue;
  const urlListaProduto = 'http://localhost:8080/produtos/listagemProdutos';
  const urlGravarProduto = 'http://localhost:8080/produtos/gravarProduto';

implementation

{$R *.dfm}


procedure TfrmPrincipal.btnSalvarClick(Sender: TObject);
begin
  dmPrincipal.GravarNovosProdutos;
end;

procedure TfrmPrincipal.FormCreate(Sender: TObject);
begin
  IdHTTP := TIdHTTP.Create(nil);

  try
    Response := IdHTTP.Get(urlListaProduto);
  finally
    IdHTTP.Free;
  end;

  dmPrincipal.BuscarProdutos(Response);
end;

procedure TfrmPrincipal.btnImagemCorClick(Sender: TObject);
begin
  if OpenDialog.Execute then
    edtImagemProduto.Text := OpenDialog.FileName;
end;

procedure TfrmPrincipal.btnImagemProdutoClick(Sender: TObject);
begin
  if OpenDialog.Execute then
    edtImagemCor.Text := OpenDialog.FileName;
end;

end.
